<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Auth â€” Sender (A)</title>
  <style>
    body { font-family: system-ui; padding: 20px; }
    button { padding: 8px 16px; border: none; border-radius: 6px; background: #0078ff; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Auth â€” Sender (A)</h2>
  <p>Yah page iframe ke zariye B ko JSON bhejega. Agar iframe block ho gaya, to button se manually bhej sakte ho.</p>
  <button id="manualSend" style="display:none;">Manually Send via Popup</button>

<script>
const now = new Date();
const B_ORIGIN = 'https://knarlix.github.io';      // Receiver origin (B)
const B_PATH = '/idkxxx/imdex.html';                // Receiver page path
const RECEIVER_URL = B_ORIGIN + B_PATH;

// Example userData
const goto = '/hi'
const userData = {
  userid: 55004733,
  username: "bfhh",
  name: "user_global_name",
  avatar: "avatar_hash_hhhhbbvhere",
  verified: false,
  authAt: now.toISOString()
};

const ack = Math.random().toString(36).slice(2);

/* Create hidden iframe */
const iframe = document.createElement('iframe');
iframe.style.display = 'none';
iframe.src = RECEIVER_URL;
document.body.appendChild(iframe);

/* Listen for acknowledgment */
window.addEventListener('message', (ev) => {
  if (ev.origin !== B_ORIGIN) return;
  const data = ev.data || {};
  if (data.type === 'auth-ack') {
    console.log('âœ… ACK received from B');
    // Redirect to B to show stored data
    window.location.href = '/idkxxx/f.hhtml';
  }
});

/* Try sending message via iframe */
iframe.addEventListener('load', () => {
  try {
    iframe.contentWindow.postMessage({ type: 'auth', ack: ack, userData, goto: goto }, B_ORIGIN);
    console.log('ðŸ“¨ Message sent to B via iframe');
  } catch (e) {
    console.error('âŒ postMessage failed:', e);
    document.getElementById('manualSend').style.display = 'inline-block';
  }
});
/* Manual fallback button (popup) */
document.getElementById('manualSend').addEventListener('click', () => {
  const popup = window.open(RECEIVER_URL, '_blank', 'width=600,height=500');
  if (!popup) {
    alert("âš ï¸ Popup blocked â€” allow popups for this site.");
    return;
  }
  const sendInterval = setInterval(() => {
    try {
      popup.postMessage({ type: 'auth', ack: ack, userData }, B_ORIGIN);
      console.log('ðŸ“¨ Message sent via manual popup');
      clearInterval(sendInterval);
    } catch {}
  }, 500);
});
</script>
</body>
</html>
