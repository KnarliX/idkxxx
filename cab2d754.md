# Discord.js Components v2 - Complete Guide with Real-World Examples

**Latest Discord.js Version:** 14.24.2+  
**Minimum Node.js Version:** 16.11.0 (Recommended: 18+)  
**Components v2 Release Date:** March 2025

---

## Table of Contents

1. [What is Components v2?](#1-what-is-components-v2)
2. [Key Differences: v1 vs v2](#2-key-differences-v1-vs-v2)
3. [Installation and Setup](#3-installation-and-setup)
4. [Core Concepts and Fundamentals](#4-core-concepts-and-fundamentals)
5. [MessageFlags.IsComponentsV2 Explained](#5-messageflags-iscomponentsv2-explained)
6. [Layout Components Deep Dive](#6-layout-components-deep-dive)
7. [Display Components Deep Dive](#7-display-components-deep-dive)
8. [Interactive Components Deep Dive](#8-interactive-components-deep-dive)
9. [Working with Attachments and Files](#9-working-with-attachments-and-files)
10. [Real-World Example: Music Bot Dashboard](#10-real-world-example-music-bot-dashboard)
11. [Real-World Example: Server Management Panel](#11-real-world-example-server-management-panel)
12. [Real-World Example: User Profile Card](#12-real-world-example-user-profile-card)
13. [Advanced Patterns and Techniques](#13-advanced-patterns-and-techniques)
14. [Best Practices and Performance Tips](#14-best-practices-and-performance-tips)
15. [Common Errors and Solutions](#15-common-errors-and-solutions)

---

## 1. What is Components v2?

Components v2 is Discord's revolutionary new messaging system that replaces traditional embeds with a flexible, component-based architecture. Instead of being limited to embed layouts, you can now arrange rich content (text, images, buttons, sections) in any order you want.

### Why Components v2 Matters

Before Components v2, your Discord message layout was restricted:
- You could send **text OR embeds** (not flexible)
- Buttons were **always at the bottom**
- Limited control over **visual hierarchy**
- **No native image galleries** (had to use embeds)
- **No sections with accessories** (text alongside images)

With Components v2, you have complete freedom:
- ✅ **Full layout control** - arrange components in any order
- ✅ **Mix and match components** - text, images, buttons anywhere
- ✅ **Native media galleries** - display multiple images in grid format
- ✅ **Sections with accessories** - text paired with thumbnails or buttons
- ✅ **Professional appearance** - modern, Discord-native UI
- ✅ **Better organization** - separators and containers for structure

### Real-World Applications

Components v2 is perfect for:
- **Music Bots** - Now Playing displays with album art and controls
- **Admin Panels** - Server management dashboards with interactive elements
- **User Profiles** - Rich profile cards with user info and actions
- **Announcements** - Beautiful news or update displays
- **Leaderboards** - Ranked lists with proper formatting
- **Store Systems** - Product displays with purchasing options
- **Ticket Systems** - Support ticket displays with actions
- **Verification Systems** - Welcome screens and onboarding flows

---

## 2. Key Differences: v1 vs v2

### Visual Comparison

**Components v1 (Old Method):**
```
┌─ Embed (fixed structure) ─┐
│ Title                      │
│ Description                │
│ [Image at bottom]          │
│ Field | Field              │
└────────────────────────────┘
[Button] [Button] [Button]  ← Always at bottom
```

**Components v2 (New Method):**
```
┌─────────────────────────┐
│ # Title                 │
│ Custom arranged content │
│ [Image]                 │
│ Text with button →  [ ] │
│ ─────────────────────── │  ← Separator
│ More content here       │
│ [Multiple Images Grid]  │
│ [Button] [Button]       │  ← Can be anywhere
└─────────────────────────┘
```

### Technical Differences

| Aspect | v1 (Embeds) | v2 (Components) |
|--------|-------------|-----------------|
| **Message Content** | `content` + `embeds` | `components` array only |
| **Button Placement** | ActionRow at bottom | Can be anywhere with Sections |
| **Images** | One image per embed | Multiple in MediaGallery |
| **Layout Control** | Very limited | Complete freedom |
| **Text Display** | Embed fields | TextDisplay components |
| **Maximum Items** | 25 fields per embed | 40 components total |
| **Text Limit** | Per field limits | 4000 total across all TextDisplay |
| **Visual Structure** | Fixed embed look | Customizable with Containers |
| **Media Gallery** | Not native | Built-in component |
| **Separators** | N/A | Full separator support |

---

## 3. Installation and Setup

### Step 1: Install Latest Discord.js

```bash
# Install or update discord.js to latest version
npm install discord.js@latest

# Verify installation
npm list discord.js
# Output should show: discord.js@14.24.2 (or higher)

# Check Node.js version
node -v
# Output should show: v18.x.x or higher
```

### Step 2: Initialize Your Bot

```javascript
const { 
    Client, 
    GatewayIntentBits,
    MessageFlags,
    Collection
} = require('discord.js');

// Create client with necessary intents
const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.MessageContent,
        GatewayIntentBits.DirectMessages
    ]
});

// Set up collections for commands
client.commands = new Collection();
client.buttons = new Collection();

// Login
client.login(process.env.DISCORD_TOKEN);
```

### Step 3: Required Imports

```javascript
// For text and display
const { TextDisplayBuilder } = require('discord.js');
const { ThumbnailBuilder } = require('discord.js');
const { MediaGalleryBuilder, MediaGalleryItemBuilder } = require('discord.js');
const { FileBuilder } = require('discord.js');

// For layout
const { ContainerBuilder } = require('discord.js');
const { SectionBuilder } = require('discord.js');
const { SeparatorBuilder, SeparatorSpacingSize } = require('discord.js');
const { ActionRowBuilder } = require('discord.js');

// For interactive
const { ButtonBuilder, ButtonStyle } = require('discord.js');
const { 
    StringSelectMenuBuilder, 
    StringSelectMenuOptionBuilder 
} = require('discord.js');
const { UserSelectMenuBuilder } = require('discord.js');

// For flags
const { MessageFlags } = require('discord.js');

// For attachments
const { AttachmentBuilder } = require('discord.js');
```

---

## 4. Core Concepts and Fundamentals

### Understanding Component Types

Components v2 has three main categories:

#### Layout Components (Structure)
These organize your message structure and don't display content directly:
- **ActionRow** - Container for interactive components (buttons, select menus)
- **Container** - Groups components together with optional styling and accent color
- **Section** - Groups text components with optional thumbnail or button accessory
- **Separator** - Adds visual space or divider between components

#### Display Components (Content)
These show actual content:
- **TextDisplay** - Markdown-formatted text (replaces embed description/fields)
- **Thumbnail** - Small image in sections (replaces embed thumbnail)
- **MediaGallery** - Grid of multiple images (replaces embed image gallery)
- **File** - Displays uploaded files in message body

#### Interactive Components (Actions)
These respond to user interaction:
- **Button** - Clickable buttons with styles (Primary, Secondary, Success, Danger, Link)
- **StringSelectMenu** - Dropdown with custom options
- **UserSelectMenu** - Select users
- **RoleSelectMenu** - Select roles
- **ChannelSelectMenu** - Select channels
- **MentionableSelectMenu** - Select users and roles

### Component ID System

Every component has an ID to identify it:

```javascript
// Automatic ID (1, 2, 3, etc.)
const text = new TextDisplayBuilder()
    .setContent('Hello');  // ID auto-generated

// Manual ID (optional)
const customText = new TextDisplayBuilder()
    .setContent('World')
    .setId(5);  // Manual ID for tracking

// Custom ID for interactive components
const button = new ButtonBuilder()
    .setCustomId('my_unique_button_id')  // REQUIRED for buttons
    .setLabel('Click Me')
    .setStyle(ButtonStyle.Primary);
```

### Total Component Limits

Important limits to remember:

```javascript
// Maximum 40 components TOTAL per message
const container = new ContainerBuilder();

// ✅ Good - Within limits
for (let i = 0; i < 30; i++) {
    container.addTextDisplayComponents(
        new TextDisplayBuilder().setContent(`Item ${i}`)
    );
}

// ❌ Bad - Exceeds 40 component limit
for (let i = 0; i < 50; i++) {
    container.addTextDisplayComponents(
        new TextDisplayBuilder().setContent(`Item ${i}`)
    );
}
```

Text character limit across all TextDisplay components:

```javascript
// Maximum 4000 characters TOTAL across all TextDisplay

// ✅ Good - Total is 3000 characters
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(1500))
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('b'.repeat(1500))
    );  // Total: 3000 ✅

// ❌ Bad - Total exceeds 4000 characters
const badContainer = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(2500))
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('b'.repeat(2500))
    );  // Total: 5000 ❌ ERROR
```

---

## 5. MessageFlags.IsComponentsV2 Explained

The most critical part of using Components v2 is the `MessageFlags.IsComponentsV2` flag. This tells Discord to render your message with the new Components v2 system.

### Why This Flag is Essential

```javascript
// ❌ WITHOUT FLAG - Won't work properly
await channel.send({
    components: [myContainer]
    // Missing flag causes issues
});

// ✅ WITH FLAG - Works correctly
await channel.send({
    components: [myContainer],
    flags: MessageFlags.IsComponentsV2  // ✅ REQUIRED
});
```

### Using with Interactions

```javascript
// For slash commands
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('mycommand')
        .setDescription('My command'),
    
    async execute(interaction) {
        const myContainer = new ContainerBuilder()
            .addTextDisplayComponents(
                new TextDisplayBuilder().setContent('Hello!')
            );
        
        // Reply with flag
        await interaction.reply({
            components: [myContainer],
            flags: MessageFlags.IsComponentsV2  // ✅ Don't forget!
        });
        
        // Or editReply with flag
        await interaction.editReply({
            components: [myContainer],
            flags: MessageFlags.IsComponentsV2  // ✅ Don't forget!
        });
    }
};
```

### What You Cannot Do with Components v2

```javascript
// ❌ CANNOT use content field
await channel.send({
    content: 'Hello',  // ❌ ERROR - Not allowed
    components: [container],
    flags: MessageFlags.IsComponentsV2
});

// ❌ CANNOT use embeds field
await channel.send({
    embeds: [myEmbed],  // ❌ ERROR - Not allowed
    components: [container],
    flags: MessageFlags.IsComponentsV2
});

// ❌ CANNOT use stickers field
await channel.send({
    stickers: ['sticker_id'],  // ❌ ERROR - Not allowed
    components: [container],
    flags: MessageFlags.IsComponentsV2
});

// ❌ CANNOT use poll field
await channel.send({
    poll: { question: 'Vote?' },  // ❌ ERROR - Not allowed
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

---

## 6. Layout Components Deep Dive

### 6.1 Container Component

The Container is your primary layout tool. It groups components together and provides optional styling.

#### Basic Container Structure

```javascript
const { ContainerBuilder, TextDisplayBuilder, MessageFlags } = require('discord.js');

const container = new ContainerBuilder()
    .setAccentColor(0x5865F2)  // Left side color (Blue)
    .setSpoiler(false)  // Hide until clicked
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('# Main Title'),
        new TextDisplayBuilder().setContent('Description text here')
    );

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Container with Accent Colors

```javascript
// Different colors for different purposes
const successContainer = new ContainerBuilder()
    .setAccentColor(0x57F287);  // Green

const warningContainer = new ContainerBuilder()
    .setAccentColor(0xFEE75C);  // Yellow

const errorContainer = new ContainerBuilder()
    .setAccentColor(0xED4245);  // Red

const infoContainer = new ContainerBuilder()
    .setAccentColor(0x5865F2);  // Blue

const customColorContainer = new ContainerBuilder()
    .setAccentColor(0x9C27B0);  // Purple (custom)
```

#### Complex Container Example

```javascript
const complexContainer = new ContainerBuilder()
    .setAccentColor(0x5865F2)
    
    // Header section
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('# 🎵 Now Playing\n*From Spotify*')
    )
    
    // Separator
    .addSeparatorComponents(
        new SeparatorBuilder()
            .setDivider(true)
            .setSpacing(SeparatorSpacingSize.Large)
    )
    
    // Middle content
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('Song Title here\nArtist Name')
    )
    
    // Another separator
    .addSeparatorComponents(
        new SeparatorBuilder()
            .setDivider(false)
            .setSpacing(SeparatorSpacingSize.Small)
    )
    
    // Footer
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('*00:45 / 03:30*')
    );

await channel.send({
    components: [complexContainer],
    flags: MessageFlags.IsComponentsV2
});
```

### 6.2 Section Component

Sections group text components (1-3 TextDisplay) with an optional accessory (Thumbnail or Button).

#### Section with Thumbnail

```javascript
const { 
    SectionBuilder, 
    TextDisplayBuilder,
    ThumbnailBuilder 
} = require('discord.js');

const sectionWithThumbnail = new SectionBuilder()
    // Add 1-3 text components
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**User Name**'),
        new TextDisplayBuilder().setContent('Status: Online\nLevel: 42')
    )
    // Add thumbnail accessory (right side)
    .setThumbnailAccessory(
        new ThumbnailBuilder({
            media: { url: 'https://example.com/avatar.png' },
            description: 'User avatar',  // Alt text
            spoiler: false
        })
    );

const container = new ContainerBuilder()
    .addSectionComponents(sectionWithThumbnail);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Section with Button

```javascript
const sectionWithButton = new SectionBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Action Required**'),
        new TextDisplayBuilder().setContent('Click the button to verify')
    )
    .setButtonAccessory(
        new ButtonBuilder()
            .setCustomId('verify_button')
            .setLabel('Verify')
            .setStyle(ButtonStyle.Success)
            .setEmoji('✅')
    );

const container = new ContainerBuilder()
    .addSectionComponents(sectionWithButton);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Multiple Sections in Container

```javascript
const multiSectionContainer = new ContainerBuilder()
    .setAccentColor(0x5865F2)
    
    // Section 1
    .addSectionComponents(
        new SectionBuilder()
            .addTextDisplayComponents(
                new TextDisplayBuilder().setContent('**Item 1**'),
                new TextDisplayBuilder().setContent('Description of item 1')
            )
            .setThumbnailAccessory(
                new ThumbnailBuilder({
                    media: { url: 'https://example.com/item1.png' },
                    description: 'Item 1 image'
                })
            )
    )
    
    // Separator between sections
    .addSeparatorComponents(
        new SeparatorBuilder()
            .setDivider(true)
            .setSpacing(SeparatorSpacingSize.Small)
    )
    
    // Section 2
    .addSectionComponents(
        new SectionBuilder()
            .addTextDisplayComponents(
                new TextDisplayBuilder().setContent('**Item 2**'),
                new TextDisplayBuilder().setContent('Description of item 2')
            )
            .setThumbnailAccessory(
                new ThumbnailBuilder({
                    media: { url: 'https://example.com/item2.png' },
                    description: 'Item 2 image'
                })
            )
    );

await channel.send({
    components: [multiSectionContainer],
    flags: MessageFlags.IsComponentsV2
});
```

### 6.3 Separator Component

Separators add visual spacing and optional divider lines between components.

#### Separator with Divider

```javascript
const { SeparatorBuilder, SeparatorSpacingSize } = require('discord.js');

// Separator with visible line
const separatorWithLine = new SeparatorBuilder()
    .setDivider(true)  // Shows line
    .setSpacing(SeparatorSpacingSize.Large);  // More space

// Separator without line (just spacing)
const spacingOnly = new SeparatorBuilder()
    .setDivider(false)  // No line
    .setSpacing(SeparatorSpacingSize.Small);  // Less space
```

#### Using Separators

```javascript
const container = new ContainerBuilder()
    .setAccentColor(0x5865F2)
    
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('# Section 1\nFirst content')
    )
    
    // Visual divider
    .addSeparatorComponents(
        new SeparatorBuilder()
            .setDivider(true)
            .setSpacing(SeparatorSpacingSize.Large)
    )
    
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('# Section 2\nSecond content')
    )
    
    // Just spacing (no line)
    .addSeparatorComponents(
        new SeparatorBuilder()
            .setDivider(false)
            .setSpacing(SeparatorSpacingSize.Medium)
    )
    
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('# Section 3\nThird content')
    );

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### 6.4 ActionRow Component

ActionRows hold interactive components (buttons, select menus). Maximum 5 buttons or 1 select menu per row.

#### ActionRow with Multiple Buttons

```javascript
const { 
    ActionRowBuilder, 
    ButtonBuilder, 
    ButtonStyle 
} = require('discord.js');

// Create 5 buttons in one row
const buttonRow = new ActionRowBuilder()
    .addComponents(
        new ButtonBuilder()
            .setCustomId('btn_1')
            .setLabel('Button 1')
            .setStyle(ButtonStyle.Primary)
            .setEmoji('1️⃣'),
        
        new ButtonBuilder()
            .setCustomId('btn_2')
            .setLabel('Button 2')
            .setStyle(ButtonStyle.Secondary)
            .setEmoji('2️⃣'),
        
        new ButtonBuilder()
            .setCustomId('btn_3')
            .setLabel('Button 3')
            .setStyle(ButtonStyle.Success)
            .setEmoji('3️⃣'),
        
        new ButtonBuilder()
            .setCustomId('btn_4')
            .setLabel('Button 4')
            .setStyle(ButtonStyle.Danger)
            .setEmoji('4️⃣'),
        
        new ButtonBuilder()
            .setLabel('Link')
            .setStyle(ButtonStyle.Link)
            .setURL('https://discord.js.org')
    );

// Add to container
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('Choose an option:')
    )
    .addActionRowComponents(buttonRow);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### ActionRow with Select Menu

```javascript
const { StringSelectMenuBuilder, StringSelectMenuOptionBuilder } = require('discord.js');

const selectRow = new ActionRowBuilder()
    .addComponents(
        new StringSelectMenuBuilder()
            .setCustomId('my_select')
            .setPlaceholder('Select an option')
            .setMinValues(1)
            .setMaxValues(3)  // Can select up to 3
            .addOptions(
                new StringSelectMenuOptionBuilder()
                    .setLabel('Option 1')
                    .setValue('opt1')
                    .setDescription('First option')
                    .setEmoji('1️⃣'),
                
                new StringSelectMenuOptionBuilder()
                    .setLabel('Option 2')
                    .setValue('opt2')
                    .setDescription('Second option')
                    .setEmoji('2️⃣')
                    .setDefault(true),  // Selected by default
                
                new StringSelectMenuOptionBuilder()
                    .setLabel('Option 3')
                    .setValue('opt3')
                    .setDescription('Third option')
                    .setEmoji('3️⃣')
            )
    );

const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('Select your preferences:')
    )
    .addActionRowComponents(selectRow);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

---

## 7. Display Components Deep Dive

### 7.1 TextDisplay Component

The TextDisplay component displays markdown-formatted text. It's the modern replacement for embed descriptions and fields.

#### Basic TextDisplay

```javascript
const { TextDisplayBuilder } = require('discord.js');

// Simple text
const simpleText = new TextDisplayBuilder()
    .setContent('Hello, World!');

// With markdown formatting
const formattedText = new TextDisplayBuilder()
    .setContent(`
# Heading 1
## Heading 2
### Heading 3

**Bold Text**
*Italic Text*
***Bold and Italic***
~~Strikethrough~~

\`Inline Code\`
\`\`\`js
// Code block
const message = "Hello";
\`\`\`

> Blockquote
> Multi-line blockquote

• Bullet point
- Another bullet
- More items

1. Numbered item
2. Another item
3. Third item

[Link Text](https://example.com)

<#CHANNEL_ID> - Channel mention
<@USER_ID> - User mention
<@&ROLE_ID> - Role mention
`);
```

#### Character Limits

```javascript
// Maximum 4000 characters TOTAL across all TextDisplay in one message

// ✅ Good - Well under limit
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('a'.repeat(2000))  // 2000 chars
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('b'.repeat(1500))  // 1500 chars
    );  // Total: 3500 ✅

// ❌ Bad - Exceeds 4000 limit
const badContainer = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('a'.repeat(2500))  // 2500 chars
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder()
            .setContent('b'.repeat(2000))  // 2000 chars
    );  // Total: 4500 ❌ ERROR
```

#### TextDisplay with Mentions

```javascript
// Important: Mentions work in Components v2!
const textWithMentions = new TextDisplayBuilder()
    .setContent(`
Welcome <@USER_ID>!

Check out <#CHANNEL_ID> for more info.

This announcement is for <@&ROLE_ID> members.
`);

// Send with mention control
await channel.send({
    components: [textWithMentions],
    flags: MessageFlags.IsComponentsV2,
    allowedMentions: { parse: [] }  // Prevent notifications
});
```

### 7.2 Thumbnail Component

Small images displayed alongside text in sections.

#### Basic Thumbnail

```javascript
const { ThumbnailBuilder } = require('discord.js');

// URL-based thumbnail
const urlThumbnail = new ThumbnailBuilder({
    media: { url: 'https://example.com/image.png' },
    description: 'Image alt text',  // Accessibility
    spoiler: false
});

// In a section
const section = new SectionBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Title**')
    )
    .setThumbnailAccessory(urlThumbnail);
```

#### Thumbnail from Local File

```javascript
const { AttachmentBuilder, ThumbnailBuilder } = require('discord.js');
const path = require('path');

// Create attachment
const imageAttachment = new AttachmentBuilder(
    path.join(__dirname, 'images', 'avatar.png'),
    { name: 'avatar.png' }
);

// Reference in thumbnail
const localThumbnail = new ThumbnailBuilder({
    media: { url: 'attachment://avatar.png' },
    description: 'User avatar',
    spoiler: false
});

// In section
const section = new SectionBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**User Profile**')
    )
    .setThumbnailAccessory(localThumbnail);

// Send with attachment
await channel.send({
    components: [section],
    files: [imageAttachment],  // Include file
    flags: MessageFlags.IsComponentsV2
});
```

#### Thumbnail Spoiler

```javascript
const spoilerThumbnail = new ThumbnailBuilder({
    media: { url: 'https://example.com/spoiler.png' },
    description: 'Spoiler image',
    spoiler: true  // Hidden until clicked
});
```

### 7.3 MediaGallery Component

Display multiple images in a grid format (up to 10 images).

#### Basic Media Gallery

```javascript
const { 
    MediaGalleryBuilder, 
    MediaGalleryItemBuilder,
    AttachmentBuilder 
} = require('discord.js');

// Create gallery items
const gallery = new MediaGalleryBuilder()
    .addItems(
        new MediaGalleryItemBuilder({
            media: { url: 'https://example.com/photo1.jpg' },
            description: 'First photo',
            spoiler: false
        }),
        new MediaGalleryItemBuilder({
            media: { url: 'https://example.com/photo2.jpg' },
            description: 'Second photo',
            spoiler: false
        }),
        new MediaGalleryItemBuilder({
            media: { url: 'https://example.com/photo3.jpg' },
            description: 'Third photo - spoiler',
            spoiler: true  // Hidden until clicked
        })
    );

// In container
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('# Photo Gallery')
    )
    .addMediaGalleryComponents(gallery);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Media Gallery with Local Files

```javascript
const fs = require('fs');
const path = require('path');

// Create attachments for images
const imageDir = path.join(__dirname, 'images');
const imageFiles = fs.readdirSync(imageDir)
    .filter(f => /\.(jpg|png|gif|webp)$/i.test(f))
    .slice(0, 10);  // Max 10 images

const attachments = imageFiles.map(file =>
    new AttachmentBuilder(
        path.join(imageDir, file),
        { name: file }
    )
);

// Create gallery items
const items = imageFiles.map((file, index) =>
    new MediaGalleryItemBuilder({
        media: { url: `attachment://${file}` },
        description: `Image ${index + 1}`
    })
);

const gallery = new MediaGalleryBuilder().addItems(...items);

// Send
const container = new ContainerBuilder()
    .addMediaGalleryComponents(gallery);

await channel.send({
    components: [container],
    files: attachments,  // Include files
    flags: MessageFlags.IsComponentsV2
});
```

### 7.4 File Component

Display uploaded files in the message body.

#### Basic File Component

```javascript
const { FileBuilder, AttachmentBuilder } = require('discord.js');

// Create file attachment
const pdfAttachment = new AttachmentBuilder('./documents/report.pdf', {
    name: 'report.pdf'
});

// Create file component
const fileComponent = new FileBuilder({
    file: { url: 'attachment://report.pdf' },
    spoiler: false
});

// In container
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Download Reports**')
    )
    .addFileComponents(fileComponent);

await channel.send({
    components: [container],
    files: [pdfAttachment],
    flags: MessageFlags.IsComponentsV2
});
```

#### Multiple Files

```javascript
const textFile = new AttachmentBuilder(
    Buffer.from('File content here', 'utf-8'),
    { name: 'data.txt' }
);

const jsonFile = new AttachmentBuilder(
    Buffer.from(JSON.stringify({ data: 'value' }, null, 2), 'utf-8'),
    { name: 'config.json' }
);

const container = new ContainerBuilder()
    .addFileComponents(
        new FileBuilder({ file: { url: 'attachment://data.txt' } }),
        new FileBuilder({ file: { url: 'attachment://config.json' } })
    );

await channel.send({
    components: [container],
    files: [textFile, jsonFile],
    flags: MessageFlags.IsComponentsV2
});
```

---

## 8. Interactive Components Deep Dive

### 8.1 Button Component

Buttons are clickable interactive elements with different styles and actions.

#### Button Styles

```javascript
const { ButtonBuilder, ButtonStyle } = require('discord.js');

// Primary Button (Blue)
const primaryBtn = new ButtonBuilder()
    .setCustomId('btn_primary')
    .setLabel('Primary')
    .setStyle(ButtonStyle.Primary)
    .setEmoji('✅');

// Secondary Button (Grey)
const secondaryBtn = new ButtonBuilder()
    .setCustomId('btn_secondary')
    .setLabel('Secondary')
    .setStyle(ButtonStyle.Secondary)
    .setEmoji('⚙️');

// Success Button (Green)
const successBtn = new ButtonBuilder()
    .setCustomId('btn_success')
    .setLabel('Success')
    .setStyle(ButtonStyle.Success)
    .setEmoji('🎉');

// Danger Button (Red)
const dangerBtn = new ButtonBuilder()
    .setCustomId('btn_danger')
    .setLabel('Delete')
    .setStyle(ButtonStyle.Danger)
    .setEmoji('🗑️');

// Link Button (Grey with link icon)
const linkBtn = new ButtonBuilder()
    .setLabel('Visit Website')
    .setStyle(ButtonStyle.Link)
    .setURL('https://discord.js.org')
    .setEmoji('🔗');
```

#### Button with Disabled State

```javascript
const disabledBtn = new ButtonBuilder()
    .setCustomId('disabled_btn')
    .setLabel('Disabled Button')
    .setStyle(ButtonStyle.Secondary)
    .setDisabled(true);

// Re-enable later
const enabledBtn = new ButtonBuilder()
    .setCustomId('disabled_btn')
    .setLabel('Now Enabled')
    .setStyle(ButtonStyle.Secondary)
    .setDisabled(false);
```

#### Buttons in Sections

```javascript
// Section with button accessory
const sectionWithBtn = new SectionBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Verify Your Account**'),
        new TextDisplayBuilder().setContent('Click to verify')
    )
    .setButtonAccessory(
        new ButtonBuilder()
            .setCustomId('verify')
            .setLabel('Verify')
            .setStyle(ButtonStyle.Success)
    );

const container = new ContainerBuilder()
    .addSectionComponents(sectionWithBtn);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Buttons in ActionRows

```javascript
const buttonRow = new ActionRowBuilder()
    .addComponents(
        new ButtonBuilder()
            .setCustomId('play')
            .setStyle(ButtonStyle.Primary)
            .setEmoji('▶️'),
        new ButtonBuilder()
            .setCustomId('pause')
            .setStyle(ButtonStyle.Secondary)
            .setEmoji('⏸️'),
        new ButtonBuilder()
            .setCustomId('stop')
            .setStyle(ButtonStyle.Danger)
            .setEmoji('⏹️')
    );

const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Music Controls**')
    )
    .addActionRowComponents(buttonRow);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### 8.2 Handling Button Interactions

```javascript
client.on('interactionCreate', async interaction => {
    // Check if it's a button interaction
    if (!interaction.isButton()) return;
    
    // Handle different buttons
    if (interaction.customId === 'verify') {
        await interaction.reply({
            content: 'You are now verified!',
            ephemeral: true  // Only you see this
        });
    }
    
    if (interaction.customId === 'play') {
        await interaction.reply({
            content: 'Playing music...',
            ephemeral: true
        });
    }
    
    if (interaction.customId === 'pause') {
        await interaction.reply({
            content: 'Music paused.',
            ephemeral: true
        });
    }
});
```

### 8.3 Select Menus

#### String Select Menu

```javascript
const { 
    StringSelectMenuBuilder, 
    StringSelectMenuOptionBuilder,
    ActionRowBuilder 
} = require('discord.js');

const selectMenu = new StringSelectMenuBuilder()
    .setCustomId('role_select')
    .setPlaceholder('Select a role')
    .setMinValues(1)
    .setMaxValues(3)  // Can select up to 3
    .addOptions(
        new StringSelectMenuOptionBuilder()
            .setLabel('Python Developer')
            .setValue('python')
            .setDescription('Python development role')
            .setEmoji('🐍'),
        
        new StringSelectMenuOptionBuilder()
            .setLabel('JavaScript Developer')
            .setValue('javascript')
            .setDescription('JavaScript development role')
            .setEmoji('📜')
            .setDefault(true),  // Selected by default
        
        new StringSelectMenuOptionBuilder()
            .setLabel('DevOps Engineer')
            .setValue('devops')
            .setDescription('DevOps and infrastructure')
            .setEmoji('⚙️')
    );

const row = new ActionRowBuilder().addComponents(selectMenu);

const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**Select Your Roles**')
    )
    .addActionRowComponents(row);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### User Select Menu

```javascript
const { UserSelectMenuBuilder } = require('discord.js');

const userSelect = new UserSelectMenuBuilder()
    .setCustomId('user_select')
    .setPlaceholder('Select users')
    .setMinValues(1)
    .setMaxValues(5);

const row = new ActionRowBuilder().addComponents(userSelect);

const container = new ContainerBuilder()
    .addActionRowComponents(row);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

#### Role Select Menu

```javascript
const { RoleSelectMenuBuilder } = require('discord.js');

const roleSelect = new RoleSelectMenuBuilder()
    .setCustomId('role_select_menu')
    .setPlaceholder('Select roles to manage')
    .setMinValues(1)
    .setMaxValues(5);

const row = new ActionRowBuilder().addComponents(roleSelect);

const container = new ContainerBuilder()
    .addActionRowComponents(row);

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### 8.4 Handling Select Menu Interactions

```javascript
client.on('interactionCreate', async interaction => {
    // String select menu
    if (interaction.isStringSelectMenu()) {
        if (interaction.customId === 'role_select') {
            const selectedValues = interaction.values;  // Array of values
            const roleNames = selectedValues.join(', ');
            
            await interaction.reply({
                content: `You selected: ${roleNames}`,
                ephemeral: true
            });
        }
    }
    
    // User select menu
    if (interaction.isUserSelectMenu()) {
        if (interaction.customId === 'user_select') {
            const users = interaction.values;  // Array of user IDs
            const userMentions = users.map(id => `<@${id}>`).join(', ');
            
            await interaction.reply({
                content: `Selected users: ${userMentions}`,
                ephemeral: true
            });
        }
    }
    
    // Role select menu
    if (interaction.isRoleSelectMenu()) {
        if (interaction.customId === 'role_select_menu') {
            const roles = interaction.values;  // Array of role IDs
            const roleMentions = roles.map(id => `<@&${id}>`).join(', ');
            
            await interaction.reply({
                content: `Selected roles: ${roleMentions}`,
                ephemeral: true
            });
        }
    }
});
```

---

## 9. Working with Attachments and Files

### 9.1 Uploading Files with Components

```javascript
const { AttachmentBuilder } = require('discord.js');
const fs = require('fs');

// From local file
const localFile = new AttachmentBuilder('./path/to/file.pdf', {
    name: 'document.pdf'
});

// From buffer (string)
const textBuffer = Buffer.from('Hello World', 'utf-8');
const textFile = new AttachmentBuilder(textBuffer, {
    name: 'message.txt'
});

// From JSON
const jsonData = { users: 100, servers: 50 };
const jsonBuffer = Buffer.from(JSON.stringify(jsonData, null, 2), 'utf-8');
const jsonFile = new AttachmentBuilder(jsonBuffer, {
    name: 'stats.json'
});

// Send multiple files
await channel.send({
    components: [container],
    files: [localFile, textFile, jsonFile],
    flags: MessageFlags.IsComponentsV2
});
```

### 9.2 Using Files with MediaGallery

```javascript
const imageAttachments = [
    new AttachmentBuilder('./images/photo1.jpg', { name: 'photo1.jpg' }),
    new AttachmentBuilder('./images/photo2.jpg', { name: 'photo2.jpg' }),
    new AttachmentBuilder('./images/photo3.jpg', { name: 'photo3.jpg' })
];

const gallery = new MediaGalleryBuilder()
    .addItems(
        new MediaGalleryItemBuilder({
            media: { url: 'attachment://photo1.jpg' },
            description: 'Photo 1'
        }),
        new MediaGalleryItemBuilder({
            media: { url: 'attachment://photo2.jpg' },
            description: 'Photo 2'
        }),
        new MediaGalleryItemBuilder({
            media: { url: 'attachment://photo3.jpg' },
            description: 'Photo 3'
        })
    );

const container = new ContainerBuilder()
    .addMediaGalleryComponents(gallery);

await channel.send({
    components: [container],
    files: imageAttachments,
    flags: MessageFlags.IsComponentsV2
});
```

### 9.3 Using Files with Thumbnails

```javascript
const avatarAttachment = new AttachmentBuilder('./avatar.png', {
    name: 'avatar.png'
});

const section = new SectionBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('**User Profile**')
    )
    .setThumbnailAccessory(
        new ThumbnailBuilder({
            media: { url: 'attachment://avatar.png' },
            description: 'User avatar'
        })
    );

const container = new ContainerBuilder()
    .addSectionComponents(section);

await channel.send({
    components: [container],
    files: [avatarAttachment],
    flags: MessageFlags.IsComponentsV2
});
```

---

## 10. Real-World Example: Music Bot Dashboard

This example shows a complete Music Now-Playing display using all Components v2 features.

```javascript
const { 
    ContainerBuilder,
    TextDisplayBuilder,
    SeparatorBuilder,
    SeparatorSpacingSize,
    MediaGalleryBuilder,
    MediaGalleryItemBuilder,
    SectionBuilder,
    ActionRowBuilder,
    ButtonBuilder,
    ButtonStyle,
    MessageFlags,
    AttachmentBuilder
} = require('discord.js');

class MusicDashboard {
    static async sendNowPlaying(channel, track, player) {
        // Get album art if available
        const albumArt = track.artworkUrl || 'https://via.placeholder.com/300x300?text=No+Art';
        
        // Format time
        const formatTime = (ms) => {
            const mins = Math.floor(ms / 60000);
            const secs = Math.floor((ms % 60000) / 1000);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };
        
        // Progress bar
        const duration = track.duration;
        const current = player.position;
        const progress = Math.floor((current / duration) * 20);
        const progressBar = '▬'.repeat(progress) + '🔘' + '▬'.repeat(20 - progress);
        
        // Create dashboard container
        const dashboard = new ContainerBuilder()
            .setAccentColor(0x1DB954)  // Spotify green
            
            // Title
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent('# 🎵 Now Playing')
            )
            
            // Separator
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Album art
            .addMediaGalleryComponents(
                new MediaGalleryBuilder()
                    .addItems({
                        media: { url: albumArt },
                        description: `${track.title} album art`
                    })
            )
            
            // Song info
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`## ${track.title}\n*by ${track.author}*`)
            )
            
            // Progress
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`${progressBar}\n${formatTime(current)} / ${formatTime(duration)}`)
            )
            
            // Separator
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Medium)
            )
            
            // Volume section
            .addSectionComponents(
                new SectionBuilder()
                    .addTextDisplayComponents(
                        new TextDisplayBuilder()
                            .setContent(`**Volume:** ${player.volume}%`)
                    )
                    .setButtonAccessory(
                        new ButtonBuilder()
                            .setCustomId('music_volume')
                            .setLabel('🔊')
                            .setStyle(ButtonStyle.Secondary)
                            .setDisabled(true)
                    )
            );
        
        // Control buttons
        const controlRow = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setCustomId('music_prev')
                    .setEmoji('⏮️')
                    .setStyle(ButtonStyle.Secondary),
                new ButtonBuilder()
                    .setCustomId('music_playpause')
                    .setEmoji(player.playing ? '⏸️' : '▶️')
                    .setStyle(ButtonStyle.Primary),
                new ButtonBuilder()
                    .setCustomId('music_next')
                    .setEmoji('⏭️')
                    .setStyle(ButtonStyle.Secondary),
                new ButtonBuilder()
                    .setCustomId('music_stop')
                    .setEmoji('⏹️')
                    .setStyle(ButtonStyle.Danger)
            );
        
        dashboard.addActionRowComponents(controlRow);
        
        // Send
        return await channel.send({
            components: [dashboard],
            flags: MessageFlags.IsComponentsV2
        });
    }
}

// Usage in command
module.exports = {
    data: new SlashCommandBuilder()
        .setName('nowplaying')
        .setDescription('Show now playing'),
    
    async execute(interaction) {
        const player = client.manager.players.get(interaction.guildId);
        if (!player || !player.playing) {
            return interaction.reply({
                content: 'Nothing is playing',
                ephemeral: true
            });
        }
        
        await interaction.deferReply();
        await MusicDashboard.sendNowPlaying(
            interaction.channel,
            player.queue.current,
            player
        );
        
        await interaction.deleteReply();
    }
};
```

---

## 11. Real-World Example: Server Management Panel

```javascript
class ServerPanel {
    static async sendManagementPanel(guild, channel) {
        // Get server stats
        const totalMembers = guild.memberCount;
        const onlineMembers = guild.members.cache.filter(
            m => m.presence?.status !== 'offline'
        ).size;
        const botCount = guild.members.cache.filter(m => m.user.bot).size;
        const textChannels = guild.channels.cache.filter(c => c.type === 0).size;
        const voiceChannels = guild.channels.cache.filter(c => c.type === 2).size;
        const roles = guild.roles.cache.size;
        const boosts = guild.premiumSubscriptionCount;
        const boostLevel = guild.premiumTier;
        
        // Create panel
        const panel = new ContainerBuilder()
            .setAccentColor(0xF47FFF)
            
            // Header
            .addSectionComponents(
                new SectionBuilder()
                    .addTextDisplayComponents(
                        new TextDisplayBuilder()
                            .setContent(`# ${guild.name}\n*Server Management Panel*`)
                    )
                    .setThumbnailAccessory(
                        new ThumbnailBuilder({
                            media: { url: guild.iconURL({ size: 256 }) },
                            description: 'Server icon'
                        })
                    )
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Members section
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent('## 👥 Members')
            )
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`**Total:** ${totalMembers}\n**Online:** ${onlineMembers}\n**Bots:** ${botCount}`)
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Channels section
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent('## 📁 Channels')
            )
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`**Text:** ${textChannels}\n**Voice:** ${voiceChannels}\n**Roles:** ${roles}`)
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Boost section
            .addSectionComponents(
                new SectionBuilder()
                    .addTextDisplayComponents(
                        new TextDisplayBuilder()
                            .setContent(`**Boost Level:** ${boostLevel}\n**Boosts:** ${boosts}`)
                    )
                    .setButtonAccessory(
                        new ButtonBuilder()
                            .setLabel('Boost Server')
                            .setStyle(ButtonStyle.Link)
                            .setURL(`https://discord.com/channels/${guild.id}`)
                    )
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Small)
            )
            
            // Footer
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`*Created: <t:${Math.floor(guild.createdTimestamp / 1000)}:F>*`)
            );
        
        // Action buttons
        const actionRow = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setCustomId('panel_refresh')
                    .setLabel('Refresh')
                    .setStyle(ButtonStyle.Primary)
                    .setEmoji('🔄'),
                new ButtonBuilder()
                    .setCustomId('panel_settings')
                    .setLabel('Settings')
                    .setStyle(ButtonStyle.Secondary)
                    .setEmoji('⚙️'),
                new ButtonBuilder()
                    .setCustomId('panel_moderation')
                    .setLabel('Moderation')
                    .setStyle(ButtonStyle.Danger)
                    .setEmoji('🔨')
            );
        
        panel.addActionRowComponents(actionRow);
        
        return await channel.send({
            components: [panel],
            flags: MessageFlags.IsComponentsV2
        });
    }
}

// Usage
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('serverpanel')
        .setDescription('Show server management panel'),
    
    async execute(interaction) {
        await ServerPanel.sendManagementPanel(
            interaction.guild,
            interaction.channel
        );
        
        await interaction.reply({
            content: 'Panel displayed!',
            ephemeral: true
        });
    }
};
```

---

## 12. Real-World Example: User Profile Card

```javascript
class UserProfile {
    static async createProfileCard(user, member, guild) {
        const userAvatar = user.displayAvatarURL({ size: 256 });
        const joinedAt = Math.floor(member.joinedTimestamp / 1000);
        const createdAt = Math.floor(user.createdTimestamp / 1000);
        
        const roles = member.roles.cache
            .filter(r => r.id !== guild.id)
            .map(r => r.toString())
            .slice(0, 5);
        
        const card = new ContainerBuilder()
            .setAccentColor(0x5865F2)
            
            // Header with avatar
            .addSectionComponents(
                new SectionBuilder()
                    .addTextDisplayComponents(
                        new TextDisplayBuilder()
                            .setContent(`# ${user.username}\n*${user.globalName || 'No display name'}*`)
                    )
                    .setThumbnailAccessory(
                        new ThumbnailBuilder({
                            media: { url: userAvatar },
                            description: `${user.tag} avatar`
                        })
                    )
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Account info
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent('## 📋 Account Information')
            )
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`**User ID:** ${user.id}\n**Account Created:** <t:${createdAt}:R>\n**Bot:** ${user.bot ? 'Yes' : 'No'}`)
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Server info
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent('## 🏘️ Server Information')
            )
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`**Joined:** <t:${joinedAt}:R>\n**Member #:** ${guild.memberCount}`)
            )
            
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Large)
            )
            
            // Roles
            .addTextDisplayComponents(
                new TextDisplayBuilder()
                    .setContent(`## 🎖️ Roles (${member.roles.cache.size - 1})\n${roles.join(' ') || 'No roles'}`)
            );
        
        // Action buttons
        const actionRow = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setLabel('Send DM')
                    .setStyle(ButtonStyle.Link)
                    .setURL(`https://discord.com/users/${user.id}`),
                new ButtonBuilder()
                    .setCustomId('profile_info')
                    .setLabel('More Info')
                    .setStyle(ButtonStyle.Secondary)
            );
        
        card.addActionRowComponents(actionRow);
        
        return card;
    }
}

// Usage
module.exports = {
    data: new SlashCommandBuilder()
        .setName('profile')
        .setDescription('View user profile')
        .addUserOption(option =>
            option.setName('user')
                .setDescription('User to view')
                .setRequired(false)
        ),
    
    async execute(interaction) {
        const user = interaction.options.getUser('user') || interaction.user;
        const member = await interaction.guild.members.fetch(user.id);
        
        const profileCard = await UserProfile.createProfileCard(
            user,
            member,
            interaction.guild
        );
        
        await interaction.reply({
            components: [profileCard],
            flags: MessageFlags.IsComponentsV2
        });
    }
};
```

---

## 13. Advanced Patterns and Techniques

### 13.1 Paginated Messages

```javascript
class PaginatedComponents {
    constructor(pages, userId) {
        this.pages = pages;  // Array of containers
        this.currentPage = 0;
        this.userId = userId;
    }
    
    createNavigation() {
        const prevBtn = new ButtonBuilder()
            .setCustomId('page_prev')
            .setLabel('◀ Prev')
            .setStyle(ButtonStyle.Secondary)
            .setDisabled(this.currentPage === 0);
        
        const pageBtn = new ButtonBuilder()
            .setCustomId('page_info')
            .setLabel(`${this.currentPage + 1} / ${this.pages.length}`)
            .setStyle(ButtonStyle.Secondary)
            .setDisabled(true);
        
        const nextBtn = new ButtonBuilder()
            .setCustomId('page_next')
            .setLabel('Next ▶')
            .setStyle(ButtonStyle.Secondary)
            .setDisabled(this.currentPage === this.pages.length - 1);
        
        return new ActionRowBuilder()
            .addComponents(prevBtn, pageBtn, nextBtn);
    }
    
    async send(interaction) {
        const navigation = this.createNavigation();
        const currentPage = this.pages[this.currentPage];
        
        // Add navigation to container
        const withNav = new ContainerBuilder()
            .addComponents(currentPage)
            .addSeparatorComponents(
                new SeparatorBuilder()
                    .setDivider(true)
                    .setSpacing(SeparatorSpacingSize.Small)
            )
            .addActionRowComponents(navigation);
        
        const message = await interaction.reply({
            components: [withNav],
            flags: MessageFlags.IsComponentsV2,
            fetchReply: true
        });
        
        // Handle pagination
        const filter = i => 
            (i.customId === 'page_prev' || i.customId === 'page_next') &&
            i.user.id === this.userId;
        
        const collector = message.createMessageComponentCollector({
            filter,
            time: 300000
        });
        
        collector.on('collect', async i => {
            if (i.customId === 'page_prev') this.currentPage--;
            else if (i.customId === 'page_next') this.currentPage++;
            
            const newNav = this.createNavigation();
            const newPage = this.pages[this.currentPage];
            
            const updated = new ContainerBuilder()
                .addComponents(newPage)
                .addSeparatorComponents(
                    new SeparatorBuilder()
                        .setDivider(true)
                        .setSpacing(SeparatorSpacingSize.Small)
                )
                .addActionRowComponents(newNav);
            
            await i.update({
                components: [updated],
                flags: MessageFlags.IsComponentsV2
            });
        });
    }
}

// Usage example
module.exports = {
    data: new SlashCommandBuilder()
        .setName('help')
        .setDescription('Show help pages'),
    
    async execute(interaction) {
        const pages = [
            new ContainerBuilder()
                .addTextDisplayComponents(
                    new TextDisplayBuilder().setContent('# Help - Page 1\n*General Commands*\n/help - Show this menu\n/ping - Bot latency')
                ),
            new ContainerBuilder()
                .addTextDisplayComponents(
                    new TextDisplayBuilder().setContent('# Help - Page 2\n*Music Commands*\n/play - Play music\n/stop - Stop music')
                ),
            new ContainerBuilder()
                .addTextDisplayComponents(
                    new TextDisplayBuilder().setContent('# Help - Page 3\n*Admin Commands*\n/ban - Ban user\n/kick - Kick user')
                )
        ];
        
        const paginated = new PaginatedComponents(pages, interaction.user.id);
        await paginated.send(interaction);
    }
};
```

### 13.2 Dynamic Component Generation

```javascript
class DynamicBuilder {
    static generateUserList(users, itemsPerPage = 5) {
        const pages = [];
        
        for (let i = 0; i < users.length; i += itemsPerPage) {
            const pageUsers = users.slice(i, i + itemsPerPage);
            
            const pageContainer = new ContainerBuilder()
                .setAccentColor(0x5865F2)
                .addTextDisplayComponents(
                    new TextDisplayBuilder()
                        .setContent(`# User List (${i / itemsPerPage + 1})`)
                );
            
            pageUsers.forEach((user, index) => {
                if (index > 0) {
                    pageContainer.addSeparatorComponents(
                        new SeparatorBuilder()
                            .setDivider(true)
                            .setSpacing(SeparatorSpacingSize.Small)
                    );
                }
                
                pageContainer.addSectionComponents(
                    new SectionBuilder()
                        .addTextDisplayComponents(
                            new TextDisplayBuilder()
                                .setContent(`**${index + i + 1}. ${user.username}**\nID: ${user.id}`),
                            new TextDisplayBuilder()
                                .setContent(`Status: ${user.status || 'Offline'}`)
                        )
                        .setThumbnailAccessory(
                            new ThumbnailBuilder({
                                media: { url: user.avatar },
                                description: `${user.username}'s avatar`
                            })
                        )
                );
            });
            
            pages.push(pageContainer);
        }
        
        return pages;
    }
}
```

### 13.3 Editing Messages with Components

```javascript
// Send initial message
const message = await channel.send({
    components: [initialContainer],
    flags: MessageFlags.IsComponentsV2
});

// Edit with new components
const newContainer = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('Updated content!')
    );

await message.edit({
    components: [newContainer],
    flags: MessageFlags.IsComponentsV2
});
```

---

## 14. Best Practices and Performance Tips

### DO's ✅

```javascript
// ✅ DO: Check component limits
function validateComponents(container) {
    const componentCount = getComponentCount(container);  // Helper function
    if (componentCount > 40) {
        throw new Error('Exceeds 40 component limit');
    }
    return true;
}

// ✅ DO: Use appropriate component types
const suitableContainer = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('Text here')
    );

// ✅ DO: Provide alt text for images
const accessibleThumbnail = new ThumbnailBuilder({
    media: { url: 'https://example.com/image.png' },
    description: 'Descriptive alt text'  // ✅ Always add
});

// ✅ DO: Handle interactions properly
client.on('interactionCreate', async interaction => {
    try {
        if (interaction.isButton()) {
            // Handle button
        } else if (interaction.isStringSelectMenu()) {
            // Handle select
        }
    } catch (error) {
        console.error(error);
        await interaction.reply({
            content: 'An error occurred',
            ephemeral: true
        });
    }
});

// ✅ DO: Use ephemeral replies for temporary info
await interaction.reply({
    content: 'Temporary message',
    ephemeral: true  // Only user sees this
});

// ✅ DO: Defer long-running operations
await interaction.deferReply();
// ... do heavy work ...
await interaction.editReply({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### DON'Ts ❌

```javascript
// ❌ DON'T: Mix old and new
await channel.send({
    content: 'Text',  // ❌ Not allowed with v2
    embeds: [embed],  // ❌ Not allowed with v2
    components: [container],
    flags: MessageFlags.IsComponentsV2
});

// ❌ DON'T: Forget the flag
await channel.send({
    components: [container]
    // ❌ Missing flag = won't work properly
});

// ❌ DON'T: Exceed text limit
const tooMuchText = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(5000))  // ❌ Exceeds 4000
    );

// ❌ DON'T: Create invalid buttons
const invalidButton = new ButtonBuilder()
    .setLabel('Button')
    .setStyle(ButtonStyle.Primary)
    // ❌ Missing customId!

// ❌ DON'T: Use mentions carelessly
const recklessMention = new TextDisplayBuilder()
    .setContent('<@USER_ID>');  // ❌ Will trigger notification!

// Proper way:
await channel.send({
    components: [textWithMention],
    flags: MessageFlags.IsComponentsV2,
    allowedMentions: { parse: [] }  // ✅ Disable notifications
});

// ❌ DON'T: Upload files without referencing
await channel.send({
    files: [attachment],
    components: [container],
    flags: MessageFlags.IsComponentsV2
    // ❌ File won't be visible without component reference
});
```

### Performance Tips

```javascript
// Optimize component generation
class OptimizedBuilder {
    // Cache frequently used components
    static readonly SEPARATOR_SMALL = new SeparatorBuilder()
        .setDivider(true)
        .setSpacing(SeparatorSpacingSize.Small);
    
    // Reuse containers
    static createCard(data) {
        const container = new ContainerBuilder()
            .setAccentColor(0x5865F2);
        
        // Add components efficiently
        data.items.forEach((item, index) => {
            if (index > 0) {
                container.addSeparatorComponents(this.SEPARATOR_SMALL);
            }
            container.addTextDisplayComponents(
                new TextDisplayBuilder().setContent(item.text)
            );
        });
        
        return container;
    }
}

// Batch operations
async function sendBulkMessages(channel, count) {
    for (let i = 0; i < count; i++) {
        const container = new ContainerBuilder()
            .addTextDisplayComponents(
                new TextDisplayBuilder().setContent(`Message ${i + 1}`)
            );
        
        await channel.send({
            components: [container],
            flags: MessageFlags.IsComponentsV2
        });
        
        // Avoid rate limiting
        await new Promise(resolve => setTimeout(resolve, 500));
    }
}
```

---

## 15. Common Errors and Solutions

### Error: "Invalid Form Body"

**Problem:**
```javascript
// ❌ Missing or wrong flag
await channel.send({
    components: [container]
});
```

**Solution:**
```javascript
// ✅ Add the flag
await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### Error: "Cannot send content with components v2"

**Problem:**
```javascript
// ❌ Using content field
await channel.send({
    content: 'Hello',
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

**Solution:**
```javascript
// ✅ Use TextDisplay instead
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('Hello')
    );

await channel.send({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});
```

### Error: "Too many components"

**Problem:**
```javascript
// ❌ Over 40 components
const container = new ContainerBuilder();
for (let i = 0; i < 50; i++) {
    container.addTextDisplayComponents(
        new TextDisplayBuilder().setContent(`${i}`)
    );
}
```

**Solution:**
```javascript
// ✅ Stay under 40 limit
const container = new ContainerBuilder();
for (let i = 0; i < 30; i++) {
    container.addTextDisplayComponents(
        new TextDisplayBuilder().setContent(`${i}`)
    );
}

// Or use multiple messages
for (let batch = 0; batch < 2; batch++) {
    const batchContainer = new ContainerBuilder();
    for (let i = 0; i < 20; i++) {
        batchContainer.addTextDisplayComponents(
            new TextDisplayBuilder().setContent(`${batch * 20 + i}`)
        );
    }
    await channel.send({
        components: [batchContainer],
        flags: MessageFlags.IsComponentsV2
    });
}
```

### Error: "Text content too long"

**Problem:**
```javascript
// ❌ Over 4000 characters total
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(3000))
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('b'.repeat(2000))
    );  // Total: 5000 characters
```

**Solution:**
```javascript
// ✅ Keep under 4000 total
const container = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(2000))
    )
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('b'.repeat(1500))
    );  // Total: 3500 ✅

// Or split across messages
const msg1 = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('a'.repeat(3500))
    );

const msg2 = new ContainerBuilder()
    .addTextDisplayComponents(
        new TextDisplayBuilder().setContent('b'.repeat(1500))
    );

await channel.send({
    components: [msg1],
    flags: MessageFlags.IsComponentsV2
});

await channel.send({
    components: [msg2],
    flags: MessageFlags.IsComponentsV2
});
```

### Error: "Attachment not found"

**Problem:**
```javascript
// ❌ File component without file
const fileComp = new FileBuilder({
    file: { url: 'attachment://file.pdf' }
});

await channel.send({
    components: [fileComp],
    flags: MessageFlags.IsComponentsV2
    // Missing files array!
});
```

**Solution:**
```javascript
// ✅ Include file in files array
const attachment = new AttachmentBuilder('./file.pdf', {
    name: 'file.pdf'
});

const fileComp = new FileBuilder({
    file: { url: 'attachment://file.pdf' }
});

await channel.send({
    components: [fileComp],
    files: [attachment],  // ✅ Include file
    flags: MessageFlags.IsComponentsV2
});
```

### Error: "Button missing customId"

**Problem:**
```javascript
// ❌ Button without customId
const button = new ButtonBuilder()
    .setLabel('Click Me')
    .setStyle(ButtonStyle.Primary);
    // Missing customId!
```

**Solution:**
```javascript
// ✅ Always add customId for non-link buttons
const button = new ButtonBuilder()
    .setCustomId('my_button')  // ✅ Required
    .setLabel('Click Me')
    .setStyle(ButtonStyle.Primary);

// Link buttons don't need customId
const linkButton = new ButtonBuilder()
    .setLabel('Visit')
    .setStyle(ButtonStyle.Link)
    .setURL('https://example.com')
    // No customId needed for Link style
```

### Error: "Interaction token invalid"

**Problem:**
```javascript
// ❌ Responding after 3 seconds without defer
await interaction.reply({
    content: 'Processing...',
    ephemeral: true
});

// Wait too long...
await new Promise(r => setTimeout(r, 5000));

await interaction.editReply({
    components: [container],
    flags: MessageFlags.IsComponentsV2
});  // ❌ Token expired!
```

**Solution:**
```javascript
// ✅ Defer first for long operations
await interaction.deferReply();

// Now you have up to 15 minutes
await new Promise(r => setTimeout(r, 5000));

await interaction.editReply({
    components: [container],
    flags: MessageFlags.IsComponentsV2  // ✅ Still valid
});
```

---

## Conclusion

Discord.js Components v2 represents a major leap forward in creating rich, interactive Discord bot messages. By mastering these components, you can create:

- **Professional-looking dashboards** for server management
- **Intuitive music bot controls** with real-time feedback
- **Beautiful user profiles** with comprehensive information
- **Advanced interaction systems** with pagination and dynamic content
- **Accessible experiences** with proper alt text and semantic structure

Remember the key principles:

1. **Always use `MessageFlags.IsComponentsV2` flag**
2. **Stay within 40 component and 4000 character limits**
3. **Provide alt text for images**
4. **Reference attachments in components**
5. **Handle interactions with proper error handling**
6. **Use the right component for the right job**

Happy building! 🚀

---

**Last Updated:** November 2025  
**Discord.js Version:** 14.24.2+  
**Node.js Version:** 18+

